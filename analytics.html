<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Taboola Pixel Code -->
<script type='text/javascript'>
  window._tfa = window._tfa || [];
  window._tfa.push({notify: 'event', name: 'page_view', id: 1909973});
  !function (t, f, a, x) {
         if (!document.getElementById(x)) {
            t.async = 1;t.src = a;t.id=x;f.parentNode.insertBefore(t, f);
         }
  }(document.createElement('script'),
  document.getElementsByTagName('script')[0],
  '//cdn.taboola.com/libtrc/unip/1909973/tfa.js',
  'tb_tfa_script');
</script>
<!-- End of Taboola Pixel Code -->
  
  <!-- PWA Manifest -->
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#8b5cf6">
<meta name="apple-mobile-web-app-capable" content="yes">

  <link rel="stylesheet" href="styles.css">
  
   <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GFG0RYJNR0"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-GFG0RYJNR0');
    </script> 
  
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DMTools.fun - Analytics Dashboard</title>
    <meta name="description" content="Track your universal message response generation analytics, usage patterns, and productivity insights across all digital messaging platforms.">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìä</text></svg>">
    
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

 <style>
   /* PAGE-SPECIFIC: Analytics Dashboard */

/* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
}

.stat-change {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: var(--success-bg);
    color: var(--success);
    padding: 0.25rem 0.5rem;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 600;
}

/* Charts Grid */
.charts-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 2rem;
    margin-bottom: 3rem;
}

.chart-section {
    background: var(--bg-input);
    border: 1px solid var(--border-medium);
    border-radius: 16px;
    padding: 2rem;
}

.chart-title {
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
    text-align: center;
}

.chart-container {
    position: relative;
    height: 300px;
}

/* Platform Grid */
.platform-charts {
    display: grid;
    grid-template-rows: 1fr 1fr;
    gap: 2rem;
}

/* Responsive (analytics-only) */
@media (max-width: 768px) {
    .charts-grid {
        grid-template-columns: 1fr;
    }
}

</style>
</head>
<body>
   <!-- Header -->
<header class="header">
    <div class="nav-container">
        <a href="/" class="logo">DMTools.fun</a>
        <div class="auth-buttons" id="authButtons">
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Menu">‚ò∞</button>
            <a href="/app.html" class="btn btn-secondary">‚Üê Back to App</a>
        </div>
    </div>
    
    <nav class="mobile-nav" id="mobileNav">
        <a href="/app.html" class="tab-btn">Generator</a>
        <a href="/presets.html" class="tab-btn">Templates</a>
        <a href="/analytics.html" class="tab-btn active">Analytics</a>
        <a href="/packs.html" class="tab-btn">Response Packs</a>
        <a href="/pricing.html" class="tab-btn">Pricing</a>
        <a href="/store.html" class="tab-btn">Packs Store</a>
        <a href="/account.html" class="tab-btn">Account</a>
    </nav>
    
    <!-- Desktop Nav Tabs -->
    <nav class="nav-tabs">
        <a href="/app.html" class="tab-btn">Generator</a>
        <a href="/presets.html" class="tab-btn">Templates</a>
        <a href="/analytics.html" class="tab-btn active">Analytics</a>
        <a href="/packs.html" class="tab-btn">Response Packs</a>
        <a href="/pricing.html" class="tab-btn">Pricing</a>
        <a href="/store.html" class="tab-btn">Packs Store</a>
        <a href="/account.html" class="tab-btn">Account</a>
    </nav>
</header>
<main>
    <!-- Main Content -->
    <div class="container">
        <!-- Page Title -->
        <div class="page-title">
            <h1>üìä Analytics Dashboard</h1>
            <p>Track your universal message response generation, usage patterns, and productivity insights.</p>
        </div>

        <!-- Analytics Content -->
        <div id="analytics-content">
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-change">+0%</div>
                    <div class="stat-icon">‚ö°</div>
                    <div class="stat-value" id="total-responses">0</div>
                    <div class="stat-label">Total Responses</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-change">This Month</div>
                    <div class="stat-icon">üìÖ</div>
                    <div class="stat-value" id="monthly-usage">0</div>
                    <div class="stat-label">Monthly Usage</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-change">+0%</div>
                    <div class="stat-icon">üìà</div>
                    <div class="stat-value" id="avg-daily">0</div>
                    <div class="stat-label">Daily Average</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-change" id="plan-badge">Active</div>
                    <div class="stat-icon">üíé</div>
                    <div class="stat-value" id="plan-type">FREE</div>
                    <div class="stat-label">Current Plan</div>
                </div>
            </div>

            <!-- Charts Grid -->
            <div class="charts-grid">
                <!-- Usage Over Time -->
                <div class="chart-section">
                    <h3 class="chart-title">Response Generation Over Time</h3>
                    <div class="chart-container">
                        <canvas id="usageChart"></canvas>
                    </div>
                </div>

                <!-- Platform Charts -->
                <div class="platform-charts">
                    <!-- Response Tones -->
                    <div class="chart-section">
                        <h3 class="chart-title">Response Tones</h3>
                        <div class="chart-container" style="height: 200px;">
                            <canvas id="toneChart"></canvas>
                        </div>
                    </div>

                    <!-- Platform Usage -->
                    <div class="chart-section">
                        <h3 class="chart-title">Platform Usage</h3>
                        <div class="chart-container" style="height: 200px;">
                            <canvas id="platformChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading-state" class="hidden">
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading your analytics data...</p>
            </div>
        </div>

        <!-- Unauthenticated State -->
        <div id="unauthenticated-state" class="hidden">
            <div style="text-align: center; padding: 4rem; background: #1f2937; border-radius: 16px; border: 1px solid #374151;">
                <div style="font-size: 4rem; margin-bottom: 1rem;">üîí</div>
                <h2 style="color: #ffffff; margin-bottom: 1rem;">Sign In to View Analytics</h2>
                <p style="color: #9ca3af; margin-bottom: 2rem;">
                    Track your message response generation, usage patterns, and productivity insights.
                </p>
                <a href="/login.html" class="btn btn-primary">Sign In</a>
                <div style="margin-top: 1rem;">
                    <p style="color: #9ca3af;">
                        Don't have an account? <a href="/register.html" style="color: #8b5cf6; text-decoration: none;">Sign up free</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
  </main>
  
 <!-- Footer -->
<footer class="footer">
    <div class="container">
        <div class="footer-content">
            <div class="footer-brand">
                <h3 class="footer-logo">DMTools.fun</h3>
                <p class="footer-description">
                    The world's first Universal Digital Messaging Response Command Center. 
                    Generate perfect responses for any digital messaging service.
                </p>
            </div>
            
            <div class="footer-links">
                <div class="link-group">
                    <h4>Product</h4>
                    <a href="/app.html">Generator</a>
                    <a href="/presets.html">Templates</a>
                    <a href="/packs.html">Response Packs</a>
                    <a href="/analytics.html">Analytics</a>
                    <a href="/pricing.html">Pricing</a>
                </div>
                
                <div class="link-group">
                    <h4>Legal</h4>
                    <a href="/terms-of-service.html">Terms of Service</a>
                    <a href="/privacy-policy.html">Privacy Policy</a>
                    <a href="/refund-policy.html">Refund Policy</a>
                    <a href="/cookie-policy.html">Cookie Policy</a>
                </div>
                
                <div class="link-group">
                    <h4>Support</h4>
                    <a href="/contact.html">Contact Support</a>
                    <a href="/account.html">My Account</a>
                    <a href="mailto:support@dmtools.fun">Email Support</a>
                    <a href="/">Back to Home</a>
                </div>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p class="footer-copyright">¬© 2025 DMTools.fun. All rights reserved.</p>
        </div>
    </div>
</footer>

    <script>
        // Global Variables
        let currentUser = null;
        let isAuthenticated = false;
        let usageChart = null;
        let toneChart = null;
        let platformChart = null;
        
        // API Configuration
        const API_BASE = 'https://dmtools-backend-production.up.railway.app/api';

      // Mobile menu toggle
        function toggleMobileMenu() {
        document.getElementById('mobileNav').classList.toggle('show');
        }
        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìä Initializing DMTools Analytics Dashboard...');
            checkAuthAndLoadData();
        });

        // Simple auth check and data loading
        async function checkAuthAndLoadData() {
            const token = localStorage.getItem('authToken');
            
            if (!token) {
                showUnauthenticatedState();
                return;
            }

            showLoadingState();

            try {
                // Simple API call to check auth and get user data
                const response = await fetch(`${API_BASE}/user/profile`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    currentUser = data.user;
                    isAuthenticated = true;
                    
                    // Load analytics with user data
                    loadAnalyticsData();
                } else {
                    // Token is invalid, clear it and show sign-in
                    localStorage.removeItem('authToken');
                    showUnauthenticatedState();
                }

            } catch (error) {
                console.error('Auth check failed:', error);
                showUnauthenticatedState();
            }
        }

        // Load analytics data
       // REPLACE this entire function:
async function loadAnalyticsData() {
    if (!currentUser) {
        showUnauthenticatedState();
        return;
    }

    try {
        // Get real analytics data
        const [overviewRes, platformsRes, tonesRes] = await Promise.all([
            fetch(`${API_BASE}/analytics/overview`, {
                headers: { 'Authorization': `Bearer ${localStorage.getItem('authToken')}` }
            }),
            fetch(`${API_BASE}/analytics/platforms`, {
                headers: { 'Authorization': `Bearer ${localStorage.getItem('authToken')}` }
            }),
            fetch(`${API_BASE}/analytics/tones`, {
                headers: { 'Authorization': `Bearer ${localStorage.getItem('authToken')}` }
            })
        ]);

        const overview = await overviewRes.json();
        const platforms = await platformsRes.json();
        const tones = await tonesRes.json();

        // Update stats with real data
        document.getElementById('total-responses').textContent = overview.overview.totalResponses;
        document.getElementById('monthly-usage').textContent = overview.overview.monthlyUsage;
        document.getElementById('avg-daily').textContent = Math.ceil(overview.overview.monthlyUsage / new Date().getDate());
        document.getElementById('plan-type').textContent = (overview.overview.currentPlan || 'free').toUpperCase();

        // Update plan badge color
        const planBadge = document.getElementById('plan-badge');
        const planType = (overview.overview.currentPlan || 'free').toUpperCase();
        if (planType === 'FREE') {
            planBadge.style.background = 'rgba(156, 163, 175, 0.2)';
            planBadge.style.color = '#9ca3af';
        } else if (planType === 'PRO') {
            planBadge.style.background = 'rgba(139, 92, 246, 0.2)';
            planBadge.style.color = '#8b5cf6';
        } else {
            planBadge.style.background = 'rgba(251, 191, 36, 0.2)';
            planBadge.style.color = '#fbbf24';
        }

        // Create charts with real data
        createRealCharts(overview.dailyUsage, platforms.platforms, tones.tones);
        
        showAnalyticsContent();
        
    } catch (error) {
        console.error('Failed to load analytics:', error);
        // Fallback to demo data
        createChartsWithUserData(currentUser.monthly_usage || 0);
        showAnalyticsContent();
    }
}
      
     // ADD this new function after loadAnalyticsData():
function createRealCharts(dailyUsage, platformData, toneData) {
    // Process daily usage for chart
    const last7Days = [];
    const today = new Date();
    for (let i = 6; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(date.getDate() - i);
        const dateStr = date.toISOString().split('T')[0];
        
        const usage = dailyUsage.find(d => d.date === dateStr);
        last7Days.push({
            label: i === 0 ? 'Today' : i === 1 ? 'Yesterday' : `${i} days ago`,
            value: usage ? usage.count : 0
        });
    }

    createUsageChart({
        labels: last7Days.map(d => d.label),
        data: last7Days.map(d => d.value)
    });

    createToneChart({
        labels: toneData.map(t => t.tone || 'Unknown'),
        data: toneData.map(t => t.count)
    });

    createPlatformChart({
        labels: platformData.map(p => p.platform || 'Unknown'),
        data: platformData.map(p => p.count)
    });
}
      

        // Create charts with user-based data
        function createChartsWithUserData(usage) {
            // Usage chart - last 7 days pattern
            const dailyAvg = Math.ceil(usage / 30) || 1;
            const usageData = {
                labels: ['6 days ago', '5 days ago', '4 days ago', '3 days ago', '2 days ago', 'Yesterday', 'Today'],
                data: Array(7).fill().map(() => Math.max(0, dailyAvg + Math.floor(Math.random() * 6) - 3))
            };

            // Tone distribution
            const toneData = {
                labels: ['Friendly', 'Professional', 'Enthusiastic', 'Grateful', 'Supportive'],
                data: usage > 0 ? [
                    Math.floor(usage * 0.4),  // Friendly
                    Math.floor(usage * 0.3),  // Professional
                    Math.floor(usage * 0.15), // Enthusiastic
                    Math.floor(usage * 0.1),  // Grateful
                    Math.floor(usage * 0.05)  // Supportive
                ] : [1, 1, 1, 1, 1]
            };

            // Platform distribution
            const platformData = {
                labels: ['Instagram', 'Facebook', 'TikTok', 'X', 'LinkedIn'],
                data: usage > 0 ? [
                    Math.floor(usage * 0.4),  // Instagram
                    Math.floor(usage * 0.25), // Facebook
                    Math.floor(usage * 0.15), // TikTok
                    Math.floor(usage * 0.1),  // X
                    Math.floor(usage * 0.1)   // LinkedIn
                ] : [1, 1, 1, 1, 1]
            };

            createUsageChart(usageData);
            createToneChart(toneData);
            createPlatformChart(platformData);
        }

        // Create Usage Chart
        function createUsageChart(data) {
            const ctx = document.getElementById('usageChart');
            if (usageChart) usageChart.destroy();

            usageChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Responses Generated',
                        data: data.data,
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#374151' },
                            ticks: { color: '#9ca3af' }
                        },
                        x: {
                            grid: { color: '#374151' },
                            ticks: { color: '#9ca3af' }
                        }
                    }
                }
            });
        }

        // Create Tone Chart
        function createToneChart(data) {
            const ctx = document.getElementById('toneChart');
            if (toneChart) toneChart.destroy();

            toneChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.labels,
                    datasets: [{
                        data: data.data,
                        backgroundColor: ['#8b5cf6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#9ca3af', padding: 15 }
                        }
                    }
                }
            });
        }

        // Create Platform Chart
        function createPlatformChart(data) {
            const ctx = document.getElementById('platformChart');
            if (platformChart) platformChart.destroy();

            platformChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.labels,
                    datasets: [{
                        data: data.data,
                        backgroundColor: ['#8b5cf6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#374151' },
                            ticks: { color: '#9ca3af' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#9ca3af' }
                        }
                    }
                }
            });
        }

        // UI State Functions
        function showLoadingState() {
            document.getElementById('analytics-content').classList.add('hidden');
            document.getElementById('unauthenticated-state').classList.add('hidden');
            document.getElementById('loading-state').classList.remove('hidden');
        }

        function showAnalyticsContent() {
            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('unauthenticated-state').classList.add('hidden');
            document.getElementById('analytics-content').classList.remove('hidden');
        }

        function showUnauthenticatedState() {
            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('analytics-content').classList.add('hidden');
            document.getElementById('unauthenticated-state').classList.remove('hidden');
        }
    </script>
</body>
</html>
