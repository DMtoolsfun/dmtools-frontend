<!DOCTYPE html>
<html lang="en">
<head>
<!-- PWA Manifest -->
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#8b5cf6">
<meta name="apple-mobile-web-app-capable" content="yes">

 <link rel="stylesheet" href="styles.css">
 
 <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-K0G9YRD39L"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-K0G9YRD39L');
    </script>
    
    <!-- DOMPurify - XSS Protection -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Response Templates - DMTools.fun</title>
    <meta name="description" content="Create and manage custom response templates for any digital messaging platform. Save time with pre-built responses.">
    
    <style>
        
     
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }



      
        /* Template Usage Tracker */
        .usage-tracker {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid #8b5cf6;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .usage-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .usage-count {
            font-size: 1.5rem;
            font-weight: 700;
            color: #8b5cf6;
        }

        .plan-badge {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .progress-bar {
            background: #374151;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-fill {
            background: linear-gradient(135deg, #8b5cf6, #06b6d4);
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .upgrade-hint {
            color: #9ca3af;
            font-size: 0.9rem;
        }

        /* Value Proposition Section */
        .value-section {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid #334155;
        }

        .value-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .value-card {
            text-align: center;
            padding: 1.5rem;
            background: rgba(139, 92, 246, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        .value-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .value-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 0.5rem;
        }

        .value-description {
            color: #9ca3af;
            font-size: 0.9rem;
        }

        /* Templates Section */
        .templates-section {
            background: #1f2937;
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid #374151;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ffffff;
        }

        /* Enhanced Template Form */
        .template-form {
            background: #374151;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid #4b5563;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            color: #e5e7eb;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .form-input, .form-select, .form-textarea {
            background: #1f2937;
            border: 1px solid #4b5563;
            color: #ffffff;
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 120px;
        }

        /* Live Preview */
        .preview-section {
            background: #1f2937;
            border: 1px solid #4b5563;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .preview-label {
            color: #9ca3af;
            font-size: 0.8rem;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            font-weight: 600;
        }

        .preview-content {
            color: #e5e7eb;
            font-style: italic;
            min-height: 40px;
            padding: 0.5rem;
            background: rgba(139, 92, 246, 0.05);
            border-radius: 6px;
        }

        /* Template Cards */
        .template-grid {
            display: grid;
            gap: 1rem;
        }

        .template-card {
            background: #374151;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #4b5563;
            transition: all 0.3s ease;
        }

        .template-card:hover {
            border-color: #8b5cf6;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.1);
        }

        .template-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .template-info {
            flex: 1;
        }

        .template-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .template-category {
            background: #8b5cf6;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            display: inline-block;
        }

        .template-actions {
            display: flex;
            gap: 0.5rem;
            flex-shrink: 0;
        }

        .copy-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .copy-btn:hover {
            background: #059669;
            transform: translateY(-1px);
        }

        .copy-btn.copied {
            background: #06b6d4;
        }

        .delete-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 0.5rem;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }

        .template-response {
            color: #e5e7eb;
            line-height: 1.6;
            background: rgba(15, 23, 42, 0.5);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 3px solid #8b5cf6;
        }

        .template-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .tag {
            background: rgba(139, 92, 246, 0.2);
            color: #a78bfa;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        /* Example Templates Section */
        .examples-section {
            margin-bottom: 2rem;
        }

        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .example-card {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid #8b5cf6;
            border-radius: 12px;
            padding: 1.5rem;
        }

        .example-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .example-name {
            font-weight: 600;
            color: #ffffff;
        }

        .example-response {
            color: #e5e7eb;
            margin-bottom: 1rem;
            font-style: italic;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #9ca3af;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #e5e7eb;
        }

        .empty-description {
            margin-bottom: 2rem;
        }

        /* Authentication Modal */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .auth-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .auth-modal-content {
            background: #1f2937;
            border-radius: 16px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            border: 1px solid #374151;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: #9ca3af;
            font-size: 1.5rem;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: #374151;
            color: #ffffff;
        }

        .auth-modal-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #ffffff;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid #ef4444;
            color: #ef4444;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .success-message {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid #10b981;
            color: #10b981;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

     

    </style>
</head>
<body>
    <!-- Header -->
<header class="header">
    <div class="nav-container">
        <a href="/" class="logo">DMTools.fun</a>
        <div class="auth-buttons" id="authButtons">
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Menu">‚ò∞</button>
            
            <div id="auth-section" class="auth-buttons">
                <button class="btn btn-secondary" data-auth="login">Sign In</button>
                <button class="btn btn-primary" data-auth="register">Sign Up Free</button>
            </div>
            
            <div id="user-section" class="auth-buttons hidden">
                <span class="user-email" id="user-email"></span>
                <button class="btn btn-secondary" onclick="logout()">Logout</button>
            </div>
        </div>
    </div>
    
    <nav class="mobile-nav" id="mobileNav">
        <a href="/app.html" class="tab-btn active">Generator</a>
        <a href="/presets.html" class="tab-btn">Templates</a>
       <!-- <a href="/analytics.html" class="tab-btn">Analytics</a>  needs debugging --->
        <a href="/packs.html" class="tab-btn">Response Packs</a>
        <a href="/pricing.html" class="tab-btn">Pricing</a>
        <a href="/store.html" class="tab-btn">Packs Store</a>
        <a href="/account.html" class="tab-btn">Account</a>
    </nav>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Page Header -->
            <div class="page-header">
                <h1 class="page-title">üìù Response Templates</h1>
                <p class="page-description">
                    Create and manage your custom response templates for quick access. 
                    Save your best responses and reuse them instantly across all platforms.
                </p>

                <!-- Template Usage Tracker -->
                <div class="usage-tracker" id="usage-tracker">
                    <div class="usage-header">
                        <div class="usage-count">
                            <span id="template-count">0</span> of <span id="template-limit">5</span> Templates Used
                        </div>
                        <div class="plan-badge" id="plan-badge">Free Plan</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="usage-progress" style="width: 0%"></div>
                    </div>
                    <div class="upgrade-hint" id="upgrade-hint">
                        Create up to 5 templates on the free plan. <a href="/pricing.html" style="color: #8b5cf6;">Upgrade for unlimited templates</a>
                    </div>
                </div>
            </div>

            <!-- Value Proposition Section (for non-authenticated users) -->
            <div class="value-section" id="value-section">
                <h2 style="text-align: center; color: #8b5cf6; margin-bottom: 2rem;">üöÄ Why Use Templates?</h2>
                <div class="value-grid">
                    <div class="value-card">
                        <div class="value-icon">‚ö°</div>
                        <div class="value-title">Save Time</div>
                        <div class="value-description">Respond to DMs 10x faster with pre-written templates</div>
                    </div>
                    <div class="value-card">
                        <div class="value-icon">üéØ</div>
                        <div class="value-title">Stay Consistent</div>
                        <div class="value-description">Maintain your brand voice across all conversations</div>
                    </div>
                    <div class="value-card">
                        <div class="value-icon">üîÑ</div>
                        <div class="value-title">Reuse Everything</div>
                        <div class="value-description">One template works across Instagram, TikTok, Twitter & more</div>
                    </div>
                    <div class="value-card">
                        <div class="value-icon">‚ú®</div>
                        <div class="value-title">AI Enhanced</div>
                        <div class="value-description">Templates get enhanced by AI for even better responses</div>
                    </div>
                </div>
            </div>

            <!-- Example Templates Section -->
            <div class="examples-section" id="examples-section">
                <h3 style="color: #ffffff; margin-bottom: 1rem;">üìã Popular Template Examples</h3>
                <p style="color: #9ca3af; margin-bottom: 1rem;">Get started with these proven templates. Sign up to customize and save your own!</p>
                
                <div class="examples-grid">
                    <div class="example-card">
                        <div class="example-header">
                            <div class="example-name">ü§ù Collaboration Interest</div>
                            <button class="btn btn-small btn-secondary" onclick="useExample('collaboration')">üìã Use This</button>
                        </div>
                        <div class="example-response">
                            "Thanks for reaching out! I'm definitely interested in collaborating. Let me check my calendar and get back to you with some ideas. What kind of timeline were you thinking?"
                        </div>
                    </div>
                    
                    <div class="example-card">
                        <div class="example-header">
                            <div class="example-name">üíï Fan Appreciation</div>
                            <button class="btn btn-small btn-secondary" onclick="useExample('fan')">üìã Use This</button>
                        </div>
                        <div class="example-response">
                            "This made my day! Thank you so much for the kind words and support. It truly means everything to me! üôè‚ú®"
                        </div>
                    </div>
                    
                    <div class="example-card">
                        <div class="example-header">
                            <div class="example-name">‚ùì Question Response</div>
                            <button class="btn btn-small btn-secondary" onclick="useExample('question')">üìã Use This</button>
                        </div>
                        <div class="example-response">
                            "Great question! I actually covered this in my recent post/story. Check it out and let me know if you need any clarification!"
                        </div>
                    </div>
                    
                    <div class="example-card">
                        <div class="example-header">
                            <div class="example-name">üíº Business Inquiry</div>
                            <button class="btn btn-small btn-secondary" onclick="useExample('business')">üìã Use This</button>
                        </div>
                        <div class="example-response">
                            "Thanks for your interest! I'd love to discuss this opportunity. Please email me at [email] with more details and we can set up a call."
                        </div>
                    </div>
                </div>
            </div>

            <!-- Templates Section -->
            <div class="templates-section">
                <div class="section-header">
                    <h2 class="section-title">Your Templates</h2>
                    <button class="btn btn-primary" id="add-template-btn" onclick="showTemplateForm()">
                        ‚ûï Add Template
                    </button>
                </div>

                <!-- Template Creation Form -->
                <div id="template-form" class="template-form hidden">
                    <h3 style="margin-bottom: 1.5rem;">Create New Template</h3>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="template-name">Template Name:</label>
                            <input 
                                type="text"
                                class="form-input" 
                                id="template-name" 
                                placeholder="e.g., Collaboration Response"
                                oninput="updatePreview()"
                            />
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="template-category">Category:</label>
                            <select class="form-select" id="template-category" onchange="updatePreview()">
                                <option value="collaboration">ü§ù Collaboration (partnerships, collabs)</option>
                                <option value="compliment">üíï Compliment (fan responses, praise)</option>
                                <option value="question">‚ùì Question (info requests, FAQs)</option>
                                <option value="business">üíº Business (work inquiries, deals)</option>
                                <option value="support">ü§ó Support (encouragement, help)</option>
                                <option value="promotional">üì¢ Promotional (product mentions, ads)</option>
                                <option value="other">üìå Other (custom responses)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="template-response">Template Response:</label>
                        <textarea 
                            class="form-textarea" 
                            id="template-response" 
                            placeholder="Enter your template response here..."
                            rows="4"
                            oninput="updatePreview()"
                        ></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="template-tags">Tags (Optional):</label>
                        <input 
                            type="text"
                            class="form-input" 
                            id="template-tags" 
                            placeholder="collaboration, brand, partnership (comma separated)"
                            oninput="updatePreview()"
                        />
                    </div>

                    <!-- Live Preview -->
                    <div class="preview-section">
                        <div class="preview-label">üìã Template Preview:</div>
                        <div class="preview-content" id="template-preview">
                            Start typing above to see your template preview...
                        </div>
                    </div>

                    <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
                        <button class="btn btn-secondary" onclick="hideTemplateForm()">Cancel</button>
                        <button class="btn btn-primary" onclick="saveTemplate()">üíæ Save Template</button>
                    </div>
                </div>

                <!-- Templates List -->
                <div id="templates-list">
                    <!-- Templates will be loaded here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Authentication Modal -->
    <div id="auth-modal" class="auth-modal">
        <div class="auth-modal-content">
            <button class="modal-close" onclick="hideAuthModal()">√ó</button>
            <div class="auth-modal-header">
                <h2 id="auth-modal-title">Sign In</h2>
                <p id="auth-modal-subtitle">Access your template library</p>
            </div>
            
            <div id="error-message" class="error-message hidden"></div>
            <div id="success-message" class="success-message hidden"></div>
            
            <div id="name-fields" class="form-grid hidden">
                <div class="form-group">
                    <label class="form-label" for="first-name">First Name:</label>
                    <input type="text" class="form-input" id="first-name" />
                </div>
                <div class="form-group">
                    <label class="form-label" for="last-name">Last Name:</label>
                    <input type="text" class="form-input" id="last-name" />
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="email">Email:</label>
                <input type="email" class="form-input" id="email" />
            </div>
            
            <div class="form-group">
                <label class="form-label" for="password">Password:</label>
                <input type="password" class="form-input" id="password" />
            </div>
            
            <button class="btn btn-primary" id="auth-submit-btn" onclick="handleAuth()" style="width: 100%;">
                Sign In
            </button>
            
            <div style="text-align: center; margin-top: 1rem;">
                <p>
                    <span id="auth-switch-text">Don't have an account?</span>
                    <button id="auth-switch-btn" onclick="toggleAuthMode()" style="background: none; border: none; color: #8b5cf6; text-decoration: underline; cursor: pointer;">Sign Up</button>
                </p>
            </div>
        </div>
    </div>

 <!-- Footer -->
<footer class="footer">
    <div class="container">
        <div class="footer-content">
            <div class="footer-brand">
                <h3 class="footer-logo">DMTools.fun</h3>
                <p class="footer-description">
                    AI-powered universal messaging response generator.
                </p>
            </div>
            
            <div class="footer-links">
                <div class="link-group">
                    <h4>Product</h4>
                    <a href="/app.html">Generator</a>
                    <a href="/presets.html">Templates</a>
                    <a href="/pricing.html">Pricing</a>
                    <a href="/store.html">Packs Store</a>
                </div>
                
                <div class="link-group">
                    <h4>Legal</h4>
                    <a href="/terms-of-service.html">Terms of Service</a>
                    <a href="/privacy-policy.html">Privacy Policy</a>
                    <a href="/refund-policy.html">Refund Policy</a>
                    <a href="/cookie-policy.html">Cookie Policy</a>
                </div>
                
                <div class="link-group">
                    <h4>Support</h4>
                    <a href="/contact.html">Contact Us</a>
                    <a href="mailto:support@dmtools.fun">Email Support</a>
                </div>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p class="footer-copyright">¬© 2025 DMTools.fun LLC. All rights reserved.</p>
        </div>
    </div>
</footer>

    <script>
        // Global Variables
        let currentUser = null;
        let isAuthenticated = false;
        let isLoginMode = true;
        let userTemplates = [];
        
        // API Configuration
        const API_BASE = 'https://dmtools-backend-production.up.railway.app/api';
// Mobile menu toggle
function toggleMobileMenu() {
    document.getElementById('mobileNav').classList.toggle('show');
}
        // Template Examples
        const templateExamples = {
            collaboration: {
                name: "Collaboration Interest",
                category: "collaboration",
                response: "Thanks for reaching out! I'm definitely interested in collaborating. Let me check my calendar and get back to you with some ideas. What kind of timeline were you thinking?",
                tags: ["collaboration", "partnership", "business"]
            },
            fan: {
                name: "Fan Appreciation", 
                category: "compliment",
                response: "This made my day! Thank you so much for the kind words and support. It truly means everything to me! üôè‚ú®",
                tags: ["appreciation", "fan", "gratitude"]
            },
            question: {
                name: "Question Response",
                category: "question", 
                response: "Great question! I actually covered this in my recent post/story. Check it out and let me know if you need any clarification!",
                tags: ["question", "faq", "help"]
            },
            business: {
                name: "Business Inquiry",
                category: "business",
                response: "Thanks for your interest! I'd love to discuss this opportunity. Please email me at [email] with more details and we can set up a call.",
                tags: ["business", "inquiry", "opportunity"]
            }
        };

        // Initialize App
        document.addEventListener('DOMContentLoaded', initializeApp);

        async function initializeApp() {
            console.log('üöÄ Initializing DMTools Templates Page...');
            
            try {
                // Check authentication
                const token = localStorage.getItem('authToken');
                if (token) {
                    try {
                        const response = await apiCall('/user/profile');
                        currentUser = response.user;
                        isAuthenticated = true;
                        await loadUserTemplates();
                    } catch (error) {
                        localStorage.removeItem('authToken');
                        isAuthenticated = false;
                    }
                }
                
                updateUI();
                
                console.log('‚úÖ Templates page initialized successfully');
            } catch (error) {
                console.error('Error during app initialization:', error);
            }
        }

        // API Call Function
        async function apiCall(endpoint, options = {}) {
            const token = localStorage.getItem('authToken');
            const url = `${API_BASE}${endpoint}`;
            
            const config = {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    ...(token && { 'Authorization': `Bearer ${token}` })
                },
                ...options
            };

            const response = await fetch(url, config);
            
            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                throw new Error(errorData.error || `Request failed: ${response.status}`);
            }

            return response.json();
        }

        // Update UI based on auth status
        function updateUI() {
            const authSection = document.getElementById('auth-section');
            const userSection = document.getElementById('user-section');
            const usageTracker = document.getElementById('usage-tracker');
            const valueSection = document.getElementById('value-section');
            const examplesSection = document.getElementById('examples-section');
            const addTemplateBtn = document.getElementById('add-template-btn');

            if (isAuthenticated) {
                authSection.classList.add('hidden');
                userSection.classList.remove('hidden');
                usageTracker.classList.remove('hidden');
                valueSection.classList.add('hidden');
                examplesSection.classList.add('hidden');
                addTemplateBtn.classList.remove('hidden');
                
                // Update user email
                document.getElementById('user-email').textContent = currentUser?.email || 'user@example.com';
                
                // Update usage tracker
                updateUsageTracker();
                
            } else {
                authSection.classList.remove('hidden');
                userSection.classList.add('hidden');
                usageTracker.classList.add('hidden');
                valueSection.classList.remove('hidden');
                examplesSection.classList.remove('hidden');
                addTemplateBtn.innerHTML = 'üîê Sign In to Create Templates';
                addTemplateBtn.onclick = () => showAuthModal(true);
            }

            updateTemplatesList();
        }

        // Update usage tracker
        function updateUsageTracker() {
            if (!isAuthenticated) return;

            const limits = { 
                free: 5, 
                starter: 10,
                pro: 20, 
                business: 200,
                enterprise: 500 
            };
            
            const userPlan = currentUser?.plan || 'free';
            const limit = limits[userPlan];
            const count = userTemplates.length;
            const percentage = Math.min((count / limit) * 100, 100);

            document.getElementById('template-count').textContent = count;
            document.getElementById('template-limit').textContent = limit;
            document.getElementById('usage-progress').style.width = percentage + '%';
            document.getElementById('plan-badge').textContent = userPlan.charAt(0).toUpperCase() + userPlan.slice(1) + ' Plan';

            const upgradeHint = document.getElementById('upgrade-hint');
            if (count >= limit * 0.8) {
                upgradeHint.innerHTML = `You're approaching your limit. <a href="/pricing.html" style="color: #8b5cf6;">Upgrade for more templates</a>`;
            } else {
                upgradeHint.innerHTML = `Create up to ${limit} templates on the ${userPlan} plan. <a href="/pricing.html" style="color: #8b5cf6;">Upgrade for more</a>`;
            }
        }

        // Template Management Functions
        function showTemplateForm() {
            if (!isAuthenticated) {
                showNotification('Please sign in to create templates', 'error');
                showAuthModal(true);
                return;
            }
            
            const limits = { 
                free: 5, 
                starter: 10,
                pro: 20, 
                business: 200,
                enterprise: 500 
            };
            const limit = limits[currentUser?.plan || 'free'];
            
            if (userTemplates.length >= limit) {
                showNotification(`Template limit reached (${limit}). Upgrade to add more templates.`, 'error');
                return;
            }
            
            document.getElementById('template-form').classList.remove('hidden');
        }

        function hideTemplateForm() {
            document.getElementById('template-form').classList.add('hidden');
            clearTemplateForm();
        }

        function clearTemplateForm() {
            document.getElementById('template-name').value = '';
            document.getElementById('template-response').value = '';
            document.getElementById('template-tags').value = '';
            document.getElementById('template-category').value = 'collaboration';
            updatePreview();
        }

        function updatePreview() {
            const name = document.getElementById('template-name').value.trim();
            const response = document.getElementById('template-response').value.trim();
            const preview = document.getElementById('template-preview');
            
            if (!name && !response) {
                preview.textContent = 'Start typing above to see your template preview...';
                preview.style.opacity = '0.5';
            } else {
                preview.textContent = response || 'Enter your response text...';
                preview.style.opacity = '1';
            }
        }

        async function saveTemplate() {
            const name = document.getElementById('template-name').value.trim();
            const category = document.getElementById('template-category').value;
            const response = document.getElementById('template-response').value.trim();
            const tagsInput = document.getElementById('template-tags').value.trim();
            
            // Convert comma-separated tags to array
            const tags = tagsInput ? tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag.length > 0) : [];
            
            if (!name || !response) {
                showNotification('Template name and response are required', 'error');
                return;
            }

            try {
                await apiCall('/presets', {
                    method: 'POST',
                    body: JSON.stringify({
                        name: name,
                        category: category,
                        response: response,
                        tags: tags
                    })
                });

                await loadUserTemplates();
                hideTemplateForm();
                showNotification('Template saved successfully!', 'success');
                updateUsageTracker();
                
            } catch (error) {
                showNotification(error.message || 'Failed to save template', 'error');
            }
        }

        async function deleteTemplate(id) {
            if (!confirm('Are you sure you want to delete this template?')) return;

            try {
                await apiCall(`/presets/${id}`, {
                    method: 'DELETE'
                });

                await loadUserTemplates();
                showNotification('Template deleted successfully', 'success');
                updateUsageTracker();
                
            } catch (error) {
                showNotification(error.message || 'Failed to delete template', 'error');
            }
        }

        async function copyTemplate(text, button) {
            try {
                await navigator.clipboard.writeText(text);
                
                // Visual feedback
                const originalText = button.innerHTML;
                button.innerHTML = '‚úÖ Copied to Clipboard!';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('copied');
                }, 2000);

                showNotification('Template copied to clipboard!', 'success');
                
            } catch (error) {
                showNotification('Failed to copy template', 'error');
            }
        }

        function useExample(type) {
            const example = templateExamples[type];
            if (!example) return;

            if (isAuthenticated) {
                // Fill the form with the example
                document.getElementById('template-name').value = example.name;
                document.getElementById('template-category').value = example.category;
                document.getElementById('template-response').value = example.response;
                document.getElementById('template-tags').value = example.tags.join(', ');
                updatePreview();
                showTemplateForm();
            } else {
                // Copy to clipboard and show signup prompt
                navigator.clipboard.writeText(example.response).then(() => {
                    showNotification('Template copied! Sign up to save and customize templates.', 'info');
                    setTimeout(() => showAuthModal(false), 2000);
                });
            }
        }

        async function loadUserTemplates() {
            if (!isAuthenticated) {
                userTemplates = [];
                return;
            }

            try {
                const response = await apiCall('/presets');
                userTemplates = response.presets || [];
            } catch (error) {
                console.error('Failed to load templates:', error);
                userTemplates = [];
            }
        }

        function updateTemplatesList() {
            const container = document.getElementById('templates-list');
            if (!container) return;
            
            if (!isAuthenticated || userTemplates.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìù</div>
                        <div class="empty-title">${isAuthenticated ? 'No templates saved yet' : 'Sign in to view your templates'}</div>
                        <div class="empty-description">
                            ${isAuthenticated 
                                ? 'Click "Add Template" to create your first response template!' 
                                : 'Create and manage your custom response templates for quick message responses.'
                            }
                        </div>
                        ${!isAuthenticated ? `
                            <button class="btn btn-primary" data-auth="register" style="margin-top: 1rem;">
                                Get Started Free
                            </button>
                        ` : ''}
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div class="template-grid">
                    ${userTemplates.map(template => {
                        // Sanitize all user-generated content to prevent XSS
                        const sanitizedName = DOMPurify.sanitize(template.name);
                        const sanitizedCategory = DOMPurify.sanitize(template.category);
                        const sanitizedResponse = DOMPurify.sanitize(template.response);
                        const sanitizedResponseForCopy = template.response.replace(/`/g, '\\`').replace(/\$/g, '\\$');
                        
                        return `
                        <div class="template-card">
                            <div class="template-header">
                                <div class="template-info">
                                    <div class="template-name">
                                        ${getCategoryIcon(template.category)} ${sanitizedName}
                                    </div>
                                    <div class="template-category">${sanitizedCategory}</div>
                                </div>
                                <div class="template-actions">
                                    <button class="copy-btn" onclick="copyTemplate(\`${sanitizedResponseForCopy}\`, this)">
                                        üìã Copy
                                    </button>
                                    <button class="delete-btn" onclick="deleteTemplate(${template.id})" title="Delete template">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                            <div class="template-response">${sanitizedResponse}</div>
                            ${template.tags && template.tags.length > 0 ? `
                                <div class="template-tags">
                                    ${template.tags.map(tag => `<span class="tag">${DOMPurify.sanitize(tag)}</span>`).join('')}
                                </div>
                            ` : ''}
                        </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function getCategoryIcon(category) {
            const icons = {
                collaboration: 'ü§ù',
                compliment: 'üíï',
                question: '‚ùì',
                business: 'üíº',
                support: 'ü§ó',
                promotional: 'üì¢',
                other: 'üìå'
            };
            return icons[category] || 'üìå';
        }

        // Authentication Functions
        function showAuthModal(loginMode) {
            // Prefer shared modal
            if (window.DMTOOLS && typeof DMTOOLS.openAuthModal === 'function') {
                const returnTo = window.location.pathname + window.location.search;
                DMTOOLS.openAuthModal(loginMode ? 'login' : 'register', { returnTo });
                return;
            }
            isLoginMode = loginMode;
            updateAuthModalUI();
            document.getElementById('auth-modal').classList.add('show');
        }

        function hideAuthModal() {
            document.getElementById('auth-modal').classList.remove('show');
            clearAuthForm();
        }

        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            updateAuthModalUI();
        }

        function updateAuthModalUI() {
            const title = document.getElementById('auth-modal-title');
            const subtitle = document.getElementById('auth-modal-subtitle');
            const nameFields = document.getElementById('name-fields');
            const submitBtn = document.getElementById('auth-submit-btn');
            const switchText = document.getElementById('auth-switch-text');
            const switchBtn = document.getElementById('auth-switch-btn');

            if (isLoginMode) {
                title.textContent = 'Sign In';
                subtitle.textContent = 'Access your template library';
                nameFields.classList.add('hidden');
                submitBtn.textContent = 'Sign In';
                switchText.textContent = "Don't have an account?";
                switchBtn.textContent = 'Sign Up';
            } else {
                title.textContent = 'Create Account';
                subtitle.textContent = 'Start building your template collection';
                nameFields.classList.remove('hidden');
                submitBtn.textContent = 'Create Account';
                switchText.textContent = 'Already have an account?';
                switchBtn.textContent = 'Sign In';
            }
        }

        async function handleAuth() {
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!email || !password) {
                showAuthError('Email and password are required');
                return;
            }

            const submitBtn = document.getElementById('auth-submit-btn');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = 'Processing...';

            try {
                if (isLoginMode) {
                    const response = await apiCall('/user/login', {
                        method: 'POST',
                        body: JSON.stringify({ email, password })
                    });
                    
                    localStorage.setItem('authToken', response.token);
                    currentUser = response.user;
                    isAuthenticated = true;
                    
                } else {
                    const firstName = document.getElementById('first-name').value.trim();
                    const lastName = document.getElementById('last-name').value.trim();
                    
                    if (!firstName || !lastName) {
                        showAuthError('First name and last name are required');
                        return;
                    }

                    const response = await apiCall('/user/register', {
                        method: 'POST',
                        body: JSON.stringify({
                            email,
                            password,
                            first_name: firstName,
                            last_name: lastName
                        })
                    });
                    
                    localStorage.setItem('authToken', response.token);
                    currentUser = response.user;
                    isAuthenticated = true;
                }

                await loadUserTemplates();
                updateUI();
                hideAuthModal();
                showNotification(`Successfully ${isLoginMode ? 'signed in' : 'registered'}!`, 'success');

            } catch (error) {
                showAuthError(error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        }

        function logout() {
            localStorage.removeItem('authToken');
            currentUser = null;
            isAuthenticated = false;
            userTemplates = [];
            updateUI();
            showNotification('Signed out successfully', 'info');
        }

        function showAuthError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            
            setTimeout(() => {
                errorDiv.classList.add('hidden');
            }, 5000);
        }

        function clearAuthForm() {
            const fields = ['email', 'password', 'first-name', 'last-name'];
            fields.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.value = '';
            });
            
            const errorDiv = document.getElementById('error-message');
            const successDiv = document.getElementById('success-message');
            errorDiv.classList.add('hidden');
            successDiv.classList.add('hidden');
        }

        // Notification System
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 2rem;
                right: 2rem;
                background: ${type === 'error' ? '#ef4444' : type === 'success' ? '#10b981' : '#3b82f6'};
                color: white;
                padding: 1rem 2rem;
                border-radius: 12px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.3);
                z-index: 10001;
                font-weight: 600;
                max-width: 400px;
                transform: translateX(100%);
                transition: transform 0.3s ease;
            `;
            notification.textContent = message;

            document.body.appendChild(notification);

            // Animate in
            requestAnimationFrame(() => {
                notification.style.transform = 'translateX(0)';
            });

            // Animate out and remove
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('auth-modal');
            if (event.target === modal) {
                hideAuthModal();
            }
        });

        console.log('‚úÖ DMTools Templates page fully loaded and optimized');
    </script>
<script src="js/app-core.js"></script>
<script src="js/auth-modal.js"></script>
</body>
</html>
